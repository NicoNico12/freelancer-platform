

create table message_room(
	id int primary key auto_increment not null,
	sender_id int not null,
	receiver_id int not null,
	job_id int,
	created timestamp default current_timestamp,
	last_message_id int null,
) engine=InnoDB;

alter table message_room add foreign key (sender_id) references users(id);
alter table message_room add foreign key (receiver_id) references users(id);
alter table message_room add foreign key (job_id) references job(id);
alter table message_room add foreign key (last_message_id) references message(id);


create table message_20171212 select * from message;

ALTER TABLE `message`
  DROP `sender_id`,
  DROP `receiver_id`,
  DROP `job_id`;
  
ALTER TABLE `message` ADD `message_room_id` INT NOT NULL AFTER `id`;

alter table message add foreign key (message_room_id) references message_room(id);